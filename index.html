<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ëª©ë°•ì‚¬ RPG - í†µí•© ì™„ì„±ë³¸</title>
<style>
  :root{
    --bg:#0e0f12; --card:#171922; --ink:#e9ecf2; --muted:#a6b0c3;
    --accent:#6ae2ff; --accent2:#9d7cff; --good:#57f287; --bad:#ff6b6b;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b0c10,#14161d);color:var(--ink);font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,Arial}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  header{display:flex;gap:12px;align-items:flex-start}
  .panel{background:var(--card);border-radius:14px;padding:12px;box-shadow:0 10px 30px #0006}
  #stats{flex:1}
  #stats h2{margin:0 0 8px;font-size:18px;color:var(--accent)}
  #main{margin-top:14px;display:grid;grid-template-columns:1.2fr 0.8fr;gap:14px}
  #dialogueBox{min-height:180px}
  #dialogue{white-space:pre-line;line-height:1.5;min-height:120px}
  #choices button, .btn{background:#232633;color:var(--ink);border:none;border-radius:10px;padding:10px 12px;cursor:pointer;font-size:14px}
  #choices button:hover,.btn:hover{filter:brightness(1.15)}
  #actionArea .btn{margin:6px 6px 0 0}
  #locationBtn{position:fixed;left:16px;bottom:16px;z-index:30}
  #inventoryBtn{position:fixed;right:16px;bottom:16px;z-index:30}
  #locationList{position:fixed;left:16px;bottom:70px;width:240px;display:none;flex-direction:column;gap:8px;z-index:40}
  #inventory{position:fixed;right:16px;bottom:70px;width:320px;display:none;z-index:40}
  .row{display:flex;justify-content:space-between;gap:8px;margin:2px 0;color:var(--muted)}
  .bar{height:10px;background:#2a2f3d;border-radius:999px;overflow:hidden}
  .fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2))}
  .muted{color:var(--muted)}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .tag{font-size:12px;color:#cbd5e1;background:#1f2430;border-radius:8px;padding:2px 8px}
  .hidden{display:none}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <section id="stats" class="panel">
      <h2>ğŸ“Š ìŠ¤íƒ¯</h2>
      <div class="row"><span>ì²´ë ¥</span><span id="hpText"></span></div>
      <div class="bar"><div id="hpBar" class="fill" style="width:100%"></div></div>
      <div class="grid2" style="margin-top:8px">
        <div class="row"><span>ê³µê²©ë ¥</span><b id="atkText"></b></div>
        <div class="row"><span>ì§€ëŠ¥</span><b id="intText"></b></div>
        <div class="row"><span>ë°©ì–´ë ¥</span><b id="defText"></b></div>
        <div class="row"><span>ëˆ</span><b id="moneyText"></b></div>
        <div class="row"><span>ëª…ì˜ˆ</span><b id="honorText"></b></div>
        <div class="row"><span>í„´</span><b id="turnText"></b></div>
      </div>
      <div id="dungeonExtra" class="grid2 hidden" style="margin-top:8px">
        <div class="row"><span>ë§ˆë‚˜</span><b id="mpText"></b></div>
        <div class="row"><span>ì¹˜ëª…íƒ€</span><b id="critText"></b></div>
      </div>
    </section>
  </header>

  <section id="main">
    <section id="dialogueBox" class="panel">
      <div id="locationName" class="tag">íŠœí† ë¦¬ì–¼</div>
      <div id="dialogue" class="muted"></div>
      <div id="choices" style="margin-top:8px"></div>
    </section>
    <section id="side" class="panel">
      <h3 style="margin:0 0 8px">âš™ï¸ í–‰ë™</h3>
      <div id="actionArea"></div>
    </section>
  </section>
</div>

<!-- Floating menus -->
<button id="locationBtn" class="btn">ğŸ—ºï¸ ì¥ì†Œ ì´ë™</button>
<div id="locationList" class="panel"></div>

<button id="inventoryBtn" class="btn">ğŸ’ ì¸ë²¤í† ë¦¬</button>
<div id="inventory" class="panel">
  <h3 style="margin:0 0 6px">ğŸ’ ì¸ë²¤í† ë¦¬</h3>
  <div id="invList" class="muted"></div>
</div>

<script>
(() => {
  // ---------- Player & Data ----------
  const player = {
    hpMax: 100, hp: 100, mpMax: 40, mp: 40,
    atk: 10, def: 2, int: 0, crit: 10, // crit: %
    money: 10000, honor: 0, turn: 1,
    inventory: {}
  };

  // Catalogs
  const ITEMS = {
    "ìŠ¤í¬ë©": {type:"ì¬ë£Œ", price:100},
    "ë°°í„°ë¦¬íŒ©": {type:"ì¬ë£Œ", price:400},
    "ê°•ì² ì¡°ê°": {type:"ì¬ë£Œ", price:300},
    "ì‘ê¸‰í‚¤íŠ¸": {type:"ì†Œëª¨", price:500, use: () => { player.hp = Math.min(player.hpMax, player.hp+40); message("ì‘ê¸‰í‚¤íŠ¸ ì‚¬ìš©! ì²´ë ¥ +40"); }},
    "ì§€ëŠ¥ì„œì ": {type:"ì†Œëª¨", price:1200, use: () => { player.int += 1; message("ì§€ëŠ¥ì„œì  ì‚¬ìš©! ì§€ëŠ¥ +1"); }},
    "ìŠ¤í¬ë©ì†Œë“œ": {type:"ë¬´ê¸°", price:1200, atk: +3},
    "ê³¼í•™ìì˜ë§ì¹˜": {type:"ë¬´ê¸°", price:3200, atk: +6},
  };

  const JUNK_EXCHANGE = [ // ê³ ë¬¼ê°€ê²Œ: ëˆ+ëª…ì˜ˆë¡œ êµí™˜
    {name:"ì‘ê¸‰í‚¤íŠ¸", money:1500, honor:1},
    {name:"ì§€ëŠ¥ì„œì ", money:2000, honor:2},
    {name:"ê³¼í•™ìì˜ë§ì¹˜", money:4000, honor:3}
  ];

  const FUKO_SHOP = [
    {name:"ë°°í„°ë¦¬íŒ©", price:400},
    {name:"ê°•ì² ì¡°ê°", price:300},
    {name:"ì‘ê¸‰í‚¤íŠ¸", price:500},
    {name:"ì§€ëŠ¥ì„œì ", price:1200}
  ];

  const LOCATIONS = [
    "íŠœí† ë¦¬ì–¼","ê³ ë¬¼ê°€ê²Œ","í‘¸ì½”ìƒì ","í—¬ìŠ¤ì¥","ë„ì„œê´€",
    "ë„ë°•ì¥","ê³¼í•™ì‹¤","ì œë ¨ì†Œ","ì •ë³´ê±°ë˜ì†Œ","íŒë§¤ì†Œ","ë˜ì „"
  ];

  // ---------- UI Elements ----------
  const hpText = document.getElementById("hpText");
  const hpBar = document.getElementById("hpBar");
  const atkText = document.getElementById("atkText");
  const defText = document.getElementById("defText");
  const intText = document.getElementById("intText");
  const moneyText = document.getElementById("moneyText");
  const honorText = document.getElementById("honorText");
  const turnText = document.getElementById("turnText");
  const mpText = document.getElementById("mpText");
  const critText = document.getElementById("critText");
  const dungeonExtra = document.getElementById("dungeonExtra");

  const dialogue = document.getElementById("dialogue");
  const choices = document.getElementById("choices");
  const actionArea = document.getElementById("actionArea");
  const locationBtn = document.getElementById("locationBtn");
  const locationList = document.getElementById("locationList");
  const inventoryBtn = document.getElementById("inventoryBtn");
  const inventoryPanel = document.getElementById("inventory");
  const invList = document.getElementById("invList");
  const locationName = document.getElementById("locationName");

  let currentLocation = "íŠœí† ë¦¬ì–¼";
  let typingLock = false;

  // ---------- Utility ----------
  function updateStats(){
    hpText.textContent = `${player.hp}/${player.hpMax}`;
    hpBar.style.width = `${Math.max(0,Math.min(100, player.hp/player.hpMax*100))}%`;
    atkText.textContent = player.atk;
    defText.textContent = player.def;
    intText.textContent = player.int;
    moneyText.textContent = player.money.toLocaleString()+"ì›";
    honorText.textContent = player.honor;
    turnText.textContent = player.turn;
    mpText.textContent = `${player.mp}/${player.mpMax}`;
    critText.textContent = `${player.crit}%`;
    dungeonExtra.classList.toggle("hidden", currentLocation!=="ë˜ì „");
    renderInventory();
  }
  function gainItem(name, n=1){
    player.inventory[name]=(player.inventory[name]||0)+n;
    tip(`ì•„ì´í…œ íšë“: ${name} x${n}`);
  }
  function consumeItem(name, n=1){
    if((player.inventory[name]||0) < n) return false;
    player.inventory[name]-=n;
    if(player.inventory[name]<=0) delete player.inventory[name];
    return true;
  }
  function renderInventory(){
    if(Object.keys(player.inventory).length===0){ invList.innerHTML = `<div class="muted">ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤.</div>`; return; }
    invList.innerHTML = "";
    for(const [k,v] of Object.entries(player.inventory)){
      const row=document.createElement("div"); row.className="row";
      const left=document.createElement("div"); left.textContent=`${k} x${v}`;
      const right=document.createElement("div");
      if(ITEMS[k]?.use){
        const b=document.createElement("button"); b.className="btn"; b.textContent="ì‚¬ìš©";
        b.onclick=()=>{ if(consumeItem(k,1)){ ITEMS[k].use(); updateStats(); } else alert("ìˆ˜ëŸ‰ ë¶€ì¡±"); };
        right.appendChild(b);
      }
      row.append(left,right); invList.appendChild(row);
    }
  }
  function message(text){ type(`${text}`); }
  function tip(t){ console.log(t); }

  // Typewriter
  async function type(text){
    if(typingLock) return;
    typingLock=true;
    dialogue.textContent="";
    choices.innerHTML="";
    const speed=18;
    for(let i=0;i<text.length;i++){
      dialogue.textContent += text[i];
      await new Promise(r=>setTimeout(r, speed));
    }
    typingLock=false;
  }

  // ---------- Dialogue / Intro ----------
  const intro = [
    `ë°•ì‚¬: ë“œë””ì–´....ë“œë””ì–´ ì¸ë¥˜ ìµœê³ ì˜ ë°œëª…í’ˆì„ ë§Œë“¤ì—ˆì–´ìš”!`,
    `ì¡°ìˆ˜: ê·¸ê²Œ ë­”ë°ìš” ë°•ì‚¬ë‹˜?`,
    `ë°•ì‚¬: ë‚´ ëª¨ëª¨ì§±ì„ ë‹®ì€ ë¬´ë“œë“±`,
    `ì¡°ìˆ˜: ì•„ë‹ˆ ê·¸ê±¸ ëˆ„ê°€ ì¨ìš”;;`,
    `ë°•ì‚¬: ...ì•„ ê·¸ëŸ°ê°€?`,
    `ì¡°ìˆ˜: í•˜....ì €ë„ ì´ì   ì§€ê²¹ë‹¤ê³ ìš”!! ì–¸ì œê¹Œì§€ ê·¸ë ‡ê²Œ í•˜ì‹¤ê±°ì—ìš”!!!`,
    `ë°•ì‚¬: ë‚´ê°€ ë¯¸ì•ˆí•˜ë‹¤ ê´‘ì¹ ì•„...`,
    `ì¡°ìˆ˜: ëŠ¦ì—ˆì–´ìš”. ì´ê±°ë‚˜ ë°›ê³  êº¼ì§€ì„¸ìš”. (ë§Œì› í•œ ì¥ì„ ë˜ì§€ê³  ë– ë‚œë‹¤)`,
    `ë°•ì‚¬: ...ì´ì   ì§„ì§œ í˜¼ìê°€ ëì–´.......`,
    `ë°•ì‚¬: ì•ˆë˜ê² ì–´! ë‚˜ ëª©ë°•ì‚¬, ê¼­ ìš°ì£¼ìµœê°• ë°•ì‚¬ê°€ ë  í…Œë‹¤!!!`,
    `ë°•ì‚¬ëŠ” ê´‘ì¹ ì´ì˜ 'ë§ˆì§€ë§‰ 1ë§Œì›'ì„ ë“¤ê³  ì¸ê·¼ ê³ ë¬¼ê°€ê²Œë¥¼ ë– ì˜¬ë ¸ë‹¤...`
  ];
  let introIdx=0;

  function nextIntro(){
    if(introIdx < intro.length){
      type(intro[introIdx++]);
    } else {
      go("íŠœí† ë¦¬ì–¼");
    }
  }
  document.addEventListener("keydown",(e)=>{ if(e.key==="Enter" && !typingLock && currentLocation==="ì¸íŠ¸ë¡œ"){ nextIntro(); }});

  // ---------- Locations / Actions ----------
  function listLocations(){
    locationList.innerHTML="";
    LOCATIONS.forEach(loc=>{
      const b=document.createElement("button"); b.className="btn"; b.textContent=loc;
      b.onclick=()=>{ go(loc); locationList.style.display="none"; };
      locationList.appendChild(b);
    });
    locationList.style.display="flex";
  }
  locationBtn.onclick=()=>{ locationList.style.display = (locationList.style.display==="flex")?"none":"flex"; };

  inventoryBtn.onclick=()=>{ inventoryPanel.style.display = (inventoryPanel.style.display==="block")?"none":"block"; };

  function go(loc){
    currentLocation = loc;
    locationName.textContent = loc;
    updateStats();
    actionArea.innerHTML="";

    // location-specific greeting + actions
    if(loc==="íŠœí† ë¦¬ì–¼"){
      type("íŠœí† ë¦¬ì–¼: ì—”í„°ë¡œ ëŒ€ì‚¬ë¥¼ ë„˜ê¸°ê³ , í•˜ë‹¨ í–‰ë™ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”. ì¢Œì¸¡ í•˜ë‹¨ 'ì¥ì†Œ ì´ë™'ìœ¼ë¡œ ë‹¤ë¥¸ ê³³ì— ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
      addBtn("ì´ˆê¸° ë³´ìƒ ë°›ê¸°", ()=>{ gainItem("ìŠ¤í¬ë©",2); player.honor+=1; player.turn++; updateStats(); }, true);
    }
    else if(loc==="ê³ ë¬¼ê°€ê²Œ"){
      type("ê³ ë¬¼ê°€ê²Œ: ëˆê³¼ ëª…ì˜ˆë¥¼ ì§€ë¶ˆí•´ íŠ¹ë³„í•œ ì•„ì´í…œìœ¼ë¡œ êµí™˜í•©ë‹ˆë‹¤.");
      JUNK_EXCHANGE.forEach(e=>{
        addBtn(`êµí™˜: ${e.name} (ëˆ ${e.money}ì› + ëª…ì˜ˆ ${e.honor})`, ()=>{
          if(player.money<e.money) return alert("ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
          if(player.honor<e.honor) return alert("ëª…ì˜ˆê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
          player.money-=e.money; player.honor-=e.honor; gainItem(e.name,1); player.turn++; updateStats();
        });
      });
    }
    else if(loc==="í‘¸ì½”ìƒì "){
      type("í‘¸ì½”ìƒì : ì¼ë°˜ ì•„ì´í…œì„ êµ¬ë§¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
      FUKO_SHOP.forEach(it=>{
        addBtn(`êµ¬ë§¤: ${it.name} (${it.price}ì›)`, ()=>{
          if(player.money<it.price) return alert("ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
          player.money-=it.price; gainItem(it.name,1); player.turn++; updateStats();
        });
      });
    }
    else if(loc==="í—¬ìŠ¤ì¥"){
      type("í—¬ìŠ¤ì¥: 2000ì›ì„ ë‚´ê³  í›ˆë ¨í•˜ì—¬ ìµœëŒ€ì²´ë ¥ì„ ì˜¬ë¦½ë‹ˆë‹¤.");
      addBtn("ìš´ë™í•˜ê¸° (2000ì›, ìµœëŒ€ì²´ë ¥+5)", ()=>{
        if(player.money<2000) return alert("ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
        player.money-=2000; player.hpMax+=5; player.hp=Math.min(player.hpMax, player.hp+5);
        player.turn++; updateStats(); message("ë•€ì„ ë¶ˆíƒœì› ë‹¤! ìµœëŒ€ì²´ë ¥ +5");
      }, true);
    }
    else if(loc==="ë„ì„œê´€"){
      type("ë„ì„œê´€: 2000ì›ì„ ë‚´ê³  ì§‘ì¤‘ ë…ì„œí•˜ì—¬ ì§€ëŠ¥ì„ ì˜¬ë¦½ë‹ˆë‹¤.");
      addBtn("ë…ì„œí•˜ê¸° (2000ì›, ì§€ëŠ¥+1)", ()=>{
        if(player.money<2000) return alert("ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
        player.money-=2000; player.int+=1; player.turn++; updateStats(); message("ì§€ì‹ì´ ë¨¸ë¦¿ì†ì„ ìŠ¤ì¹œë‹¤! ì§€ëŠ¥ +1");
      }, true);
    }
    else if(loc==="ë„ë°•ì¥"){
      type("ë„ë°•ì¥: ìŠ¬ë¡¯ë¨¸ì‹ ! 1000ì›ìœ¼ë¡œ ìš´ì„ ì‹œí—˜í•´ ë³´ì„¸ìš”.");
      addBtn("ìŠ¬ë¡¯ ëŒë¦¬ê¸° (1000ì›)", ()=>slotSpin(), true);
      const box=document.createElement("div"); box.id="slotBox"; box.style.marginTop="8px"; box.className="muted";
      box.textContent="ê²°ê³¼ ëŒ€ê¸°ì¤‘...";
      actionArea.appendChild(box);
    }
    else if(loc==="ê³¼í•™ì‹¤"){
      type("ê³¼í•™ì‹¤: ë¬´ê¸° ê°•í™”. 2000ì›, ì„±ê³µ í™•ë¥  60% (ì„±ê³µì‹œ ê³µê²©ë ¥ +1).");
      addBtn("ê°•í™” ì‹œë„ (2000ì›)", ()=>{
        if(player.money<2000) return alert("ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
        player.money-=2000; player.turn++;
        if(Math.random()<0.6){ player.atk+=1; message("ê°•í™” ì„±ê³µ! ê³µê²©ë ¥ +1"); }
        else { message("ê°•í™” ì‹¤íŒ¨... ë³€í™” ì—†ìŒ"); }
        updateStats();
      }, true);
    }
    else if(loc==="ì œë ¨ì†Œ"){
      type("ì œë ¨ì†Œ: ì¬ë£Œë¡œ ì¥ë¹„ ì œì‘. ìŠ¤í¬ë© x3 â†’ ìŠ¤í¬ë©ì†Œë“œ(ê³µ+3)");
      addBtn("ì œì‘: ìŠ¤í¬ë©ì†Œë“œ (ìŠ¤í¬ë© x3)", ()=>{
        if((player.inventory["ìŠ¤í¬ë©"]||0)<3) return alert("ìŠ¤í¬ë©ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
        consumeItem("ìŠ¤í¬ë©",3); gainItem("ìŠ¤í¬ë©ì†Œë“œ",1); player.turn++; updateStats();
      }, true);
    }
    else if(loc==="ì •ë³´ê±°ë˜ì†Œ"){
      type("ì •ë³´ê±°ë˜ì†Œ: 1500ì›ì— ë˜ì „ íŒíŠ¸ë¥¼ ì‚½ë‹ˆë‹¤.");
      addBtn("íŒíŠ¸ êµ¬ë§¤ (1500ì›)", ()=>{
        if(player.money<1500) return alert("ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
        player.money-=1500; player.turn++; updateStats();
        message("íŒíŠ¸: ì˜¤ëŠ˜ ë˜ì „ì€ 'ì „ê¸°'ì— ì•½í•˜ë‹¤. ì¹˜ëª…íƒ€ë¥¼ ë…¸ë ¤ë¼!");
      }, true);
    }
    else if(loc==="íŒë§¤ì†Œ"){
      type("íŒë§¤ì†Œ: ì•„ì´í…œì„ 50% ê°€ê²©ìœ¼ë¡œ íŒë§¤í•©ë‹ˆë‹¤.");
      // ë™ì  íŒë§¤ ëª©ë¡
      for(const [k,v] of Object.entries(player.inventory)){
        const base = ITEMS[k]?.price ?? 100;
        addBtn(`íŒë§¤: ${k} x1 (${Math.floor(base*0.5)}ì›)`, ()=>{
          if(!consumeItem(k,1)) return alert("ìˆ˜ëŸ‰ ë¶€ì¡±");
          player.money += Math.floor(base*0.5);
          player.turn++; updateStats(); renderInventory();
          message(`${k}ì„(ë¥¼) íŒ”ì•˜ë‹¤.`);
        });
      }
      if(Object.keys(player.inventory).length===0){
        const span=document.createElement("div"); span.className="muted"; span.textContent="íŒë§¤í•  ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤.";
        actionArea.appendChild(span);
      }
    }
    else if(loc==="ë˜ì „"){
      startDungeon();
    }

    document.onkeydown = (e)=>{
      if(e.key==="Enter" && !typingLock && !choices.firstChild){
        // ê¸°ë³¸ì€ ë©”ì‹œì§€ ìœ ì§€
      }
    };

    updateStats();
  }

  function addBtn(label, fn, primary=false){
    const b=document.createElement("button");
    b.className="btn"; if(primary) b.style.outline=`1px solid ${getComputedStyle(document.documentElement).getPropertyValue('--accent')}`;
    b.textContent=label; b.onclick=fn; actionArea.appendChild(b);
  }

  // ---------- Gambling (Slots) ----------
  function slotSpin(){
    if(player.money<1000) return alert("ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤!");
    player.money-=1000; player.turn++;
    const symbols=["â˜…","ğŸ”§","âš¡","ğŸ’","ğŸ”¬"];
    const r1=symbols[Math.floor(Math.random()*symbols.length)];
    const r2=symbols[Math.floor(Math.random()*symbols.length)];
    const r3=symbols[Math.floor(Math.random()*symbols.length)];
    const box=document.getElementById("slotBox");
    box.textContent=`[ ${r1} | ${r2} | ${r3} ]`;
    let reward=0, note="";
    if(r1===r2 && r2===r3){ reward=10000; note="ëŒ€ë°•!"; }
    else if(r1===r2 || r2===r3 || r1===r3){ reward=3000; note="ì¤‘ë°•!"; }
    else reward=0;
    if(reward>0){ player.money+=reward; message(`ìŠ¬ë¡¯ ê²°ê³¼: ${note} +${reward.toLocaleString()}ì›`); }
    else { message("ìŠ¬ë¡¯ ê²°ê³¼: ê½..."); }
    updateStats();
  }

  // ---------- Dungeon (Combat) ----------
  function startDungeon(){
    locationName.textContent="ë˜ì „";
    dungeonExtra.classList.remove("hidden");
    const enemy = { name:"íí—ˆì˜ ê³ ë¸”ë¦°", hpMax:60, hp:60, atk:8, reward:1200 };
    type(`ë˜ì „: ${enemy.name} ë“±ì¥! ë§ˆë‚˜ì™€ ì¹˜ëª…íƒ€ UIê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    actionArea.innerHTML="";
    const hud=document.createElement("div"); hud.className="muted"; hud.style.margin="6px 0 8px";
    const hpE=document.createElement("div"); hpE.textContent=`ì  HP: ${enemy.hp}/${enemy.hpMax}`;
    hud.appendChild(hpE); actionArea.appendChild(hud);

    function refresh(){ hpE.textContent=`ì  HP: ${enemy.hp}/${enemy.hpMax}`; updateStats(); }

    addBtn("ê³µê²©", ()=>{
      const crit = Math.random()*100 < player.crit;
      const dmg = Math.max(1, player.atk - 0) * (crit?2:1);
      enemy.hp = Math.max(0, enemy.hp - dmg);
      message(`ê³µê²©! ${crit?"ì¹˜ëª…íƒ€! ":""}${dmg} í”¼í•´`);
      player.turn++;
      if(enemy.hp<=0){ win(); return; }
      enemyTurn();
      refresh();
    }, true);

    addBtn("ìŠ¤í‚¬(ë§ˆë‚˜10)", ()=>{
      if(player.mp<10) return alert("ë§ˆë‚˜ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!");
      player.mp-=10;
      const dmg = Math.max(1, (player.atk + Math.floor(player.int*0.5)) * 2);
      enemy.hp = Math.max(0, enemy.hp - dmg);
      message(`ìŠ¤í‚¬ ë°œë™! ${dmg} í”¼í•´`);
      player.turn++;
      if(enemy.hp<=0){ win(); return; }
      enemyTurn();
      refresh();
    });

    addBtn("ë„ë§", ()=>{
      message("ë¬´ì‚¬íˆ ë¹ ì ¸ë‚˜ì™”ë‹¤...");
      go("íŠœí† ë¦¬ì–¼");
    });

    function enemyTurn(){
      const edmg = Math.max(1, enemy.atk - player.def);
      player.hp = Math.max(0, player.hp - edmg);
      tip(`ì ì˜ ë°˜ê²© ${edmg} í”¼í•´`);
      if(player.hp<=0){ lose(); }
    }
    function win(){
      message(`ìŠ¹ë¦¬! ${enemy.reward}ì›ê³¼ ëª…ì˜ˆ +1, ìŠ¤í¬ë© x1 íšë“`);
      player.money+=enemy.reward; player.honor+=1; gainItem("ìŠ¤í¬ë©",1);
      player.turn++; updateStats();
      addBtn("ë˜ì „ ì¢…ë£Œ", ()=>go("íŠœí† ë¦¬ì–¼"), true);
    }
    function lose(){
      message("íŒ¨ë°°... ê²¨ìš° ëª©ìˆ¨ì„ ê±´ì¡Œë‹¤. (ì²´ë ¥ 1ë¡œ ë³µê·€)");
      player.hp=1; player.turn++; updateStats();
      addBtn("ë˜ì „ ë‚˜ê°€ê¸°", ()=>go("íŠœí† ë¦¬ì–¼"), true);
    }

    updateStats();
  }

  // ---------- Start ----------
  function start(){
    currentLocation="ì¸íŠ¸ë¡œ";
    updateStats();
    nextIntro();
  }

  // Open menus
  document.addEventListener("click",(e)=>{
    if(!locationList.contains(e.target) && e.target!==locationBtn){ locationList.style.display="none"; }
    if(!inventoryPanel.contains(e.target) && e.target!==inventoryBtn){ inventoryPanel.style.display="none"; }
  });

  start();
})();
</script>
</body>
</html>
