<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ëª©ë°•ì‚¬ RPG â€” Web Demo</title>
<style>
  :root{--bg:#071028;--panel:#0f1720;--accent:#6ee7b7;--muted:#9fb0c8}
  html,body{height:100%;margin:0;font-family:Apple SD Gothic Neo, Malgun Gothic, 'Noto Sans KR', sans-serif;background:linear-gradient(180deg,#020617,#071028);color:#e6eef8}
  .wrap{max-width:1100px;margin:18px auto;display:grid;grid-template-columns:320px 1fr;gap:16px;padding:12px}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);padding:12px;border-radius:10px}
  h2{margin:6px 0 12px;color:var(--accent)}
  .statgrid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .stat{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px}
  .log{height:560px;overflow:auto;padding:10px;background:#021022;border-radius:8px;border:1px solid rgba(255,255,255,0.02);white-space:pre-wrap}
  .cmdline{display:flex;gap:8px;margin-top:10px}
  input[type=text]{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
  button{padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:inherit;cursor:pointer}
  table{width:100%;border-collapse:collapse}
  th,td{padding:6px;border-bottom:1px dashed rgba(255,255,255,0.03);text-align:left;font-size:13px}
  .small{font-size:12px;color:var(--muted)}
  .shop-list{max-height:220px;overflow:auto}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .badge{display:inline-block;padding:4px 8px;border-radius:999px;background:rgba(255,255,255,0.02);font-size:12px}
  .title-row{display:flex;justify-content:space-between;align-items:center}
  .mono{font-family:monospace}
  .red{color:#ff6b6b}
  .green{color:#7ee787}
</style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <div class="title-row">
        <h2>í”Œë ˆì´ì–´ ìƒíƒœ</h2>
        <div class="small">ëª©ë°•ì‚¬ RPG â€” ì›¹ ë°ëª¨</div>
      </div>
      <div class="statgrid">
        <div class="stat">ì²´ë ¥: <span id="hp">150</span> / <span id="maxHp">150</span></div>
        <div class="stat">ì§€ì‹: <span id="knowledge">100</span></div>
        <div class="stat">ëª…ì„±: <span id="reputation">100</span></div>
        <div class="stat">ëˆ: <span id="money">30</span> ì½”ì¸</div>
      </div>

      <div style="margin-top:12px;">
        <h2>ì¸ë²¤í† ë¦¬</h2>
        <div id="inventoryList" class="small">(ì•„ì§ ì•„ì´í…œ ì—†ìŒ)</div>
        <div class="small" style="margin-top:8px">ë°œëª…í’ˆ ë³´ìœ : <span id="invInventions">0</span></div>
        <div style="margin-top:8px">
          <label><input type="checkbox" id="haveGloves"> ì¥ê°‘ ì°©ìš© (ì˜êµ¬ì  íš¨ê³¼ ì‹œë®¬ë ˆì´ì…˜)</label>
          <div class="small">ì¥ê°‘ì„ ì²´í¬í•˜ë©´ ìˆ˜ì§‘ ì‹œ ì²´ë ¥/ëª…ì„± ê°ì†Œ ì™„í™”</div>
        </div>
      </div>

      <div class="panel" style="margin-top:12px">
        <h2>í‘¸ì½”ìƒì </h2>
        <div class="small">ëª…ë ¹ì–´: <code>!í‘¸ì½”ìƒì </code> / <code>!êµ¬ë§¤ [ì´ë¦„] [ìˆ˜ëŸ‰]</code></div>
        <div id="shopList" class="shop-list small" style="margin-top:8px"></div>
      </div>

      <div class="panel" style="margin-top:12px">
        <h2>ì €ì¥ ìŠ¬ë¡¯</h2>
        <div class="small">ìµœëŒ€ 10ê°œ ì €ì¥. ëª…ë ¹ì–´: <code>!ì €ì¥ [ì´ë¦„]</code> / <code>!ë¶ˆëŸ¬ì˜¤ê¸°</code> / <code>!ì €ì¥ì‚­ì œ [ì´ë¦„]</code></div>
        <div id="saveList" class="small" style="margin-top:8px"></div>
      </div>
    </div>

    <div class="panel">
      <div class="title-row"><h2>ê²Œì„ ë¡œê·¸</h2><div class="small mono">ëª…ë ¹ì–´ ì…ë ¥: !ì‹œì‘ !ìˆ˜ì§‘ !ì œì‘ ë“±</div></div>
      <div id="log" class="log"></div>

      <div class="cmdline">
        <input id="cmdInput" type="text" placeholder="ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: !ê²Œì„ì‹œì‘, !ìˆ˜ì§‘, !ì œì‘ ëª» ê³ ì² )" />
        <button id="sendBtn">ì „ì†¡</button>
      </div>

      <div class="controls">
        <button onclick="showHelp()">ëª…ë ¹ì–´ ë„ì›€</button>
        <button onclick="quickStart()">!ê²Œì„ì‹œì‘ (í€µ)</button>
        <button onclick="openShop()">í‘¸ì½”ìƒì  ë³´ê¸°</button>
        <button onclick="listSaves()">ì €ì¥ëª©ë¡</button>
      </div>
    </div>
  </div>

<script>
/* =========================
   ëª©ë°•ì‚¬ RPG â€” ì›¹ ë°ëª¨
   (ì´ íŒŒì¼ì„ index.htmlë¡œ GitHub Pagesì— ì˜¬ë¦¬ë©´ ë™ì‘í•©ë‹ˆë‹¤)
   ========================= */

/* ---------- ì´ˆê¸° ìƒíƒœ ---------- */
const DEFAULT = {
  day: 1, turns: 15,
  hp: 150, maxHp: 150,
  knowledge: 100, reputation: 100, money: 30,
  inventory: {}, // {item:count}
  inventions: [], // {name, components, state, ability, basePrice}
  gloves: false
};
let state = JSON.parse(JSON.stringify(DEFAULT));

/* ---------- ìƒì  ë°ì´í„° (í‘¸ì½”ìƒì ) ---------- */
const SHOP_ITEMS = [
  {name:'ëª»', price:10}, {name:'ê³ ì² ', price:15}, {name:'ë‚˜ë¬´', price:15},
  {name:'ì² ì œ', price:35}, {name:'ìš´ì² ', price:150}, {name:'í”Œë¼ìŠ¤í‹±', price:80},
  {name:'ì œì‘ëŒ€', price:120}, {name:'ë§ì¹˜', price:300}, {name:'íœì¹˜', price:350},
  {name:'ì•”í‘ë¬¼ì§ˆ', price:700}, {name:'ìš°ì£¼ì˜ ë¨¼ì§€', price:1000},
  {name:'ì¡°ìˆ˜ì˜ íŒ”', price:2000},{name:'ì¡°ìˆ˜ì˜ ë¨¸ë¦¬', price:2500},{name:'ì¡°ìˆ˜ì˜ ë‹¤ë¦¬', price:2000},{name:'ì¡°ìˆ˜ì˜ ì‹¬ì¥', price:3000},
  {name:'ì™¸ê³„ê³ ì² ', price:250},{name:'ì™¸ê³„ë‚˜ë¬´', price:200},{name:'ì™¸ê³„í”Œë¼ìŠ¤í‹±', price:350},
  {name:'ì‹ ì˜ ê¸ˆì†', price:800},{name:'ì•„ë§Œíƒ€ë””ì›€', price:700},{name:'ë¯¸ìŠ¤ë¦´', price:650},
  {name:'ë§Œë…„í•œì² ', price:1250},{name:'ë„ë„›ë§› ë”¸ê¸°ì¼€ì³¡', price:400},{name:'í¬ë¼ì¼„ì˜ ì ì•¡', price:700},
  {name:'ì˜¤ë¦¬í•˜ë¥´ì½˜', price:1500},{name:'ë¹„ë¸Œë¼ëŠ„', price:1350},{name:'ì¡°ìˆ˜ì„', price:1500},
  {name:'ìˆ˜ì„', price:5000},{name:'íŠ¹ìˆ˜ ì½”íŒ…ì œ', price:1200},{name:'ë°˜ë„ì²´', price:2800},{name:'ë‹¤ì´ì•„ëª¬ë“œ', price:3500},{name:'ë°•ì‚¬ì˜ ì•ˆê²½', price:2500}
];
const SHOP_MAP = {}; SHOP_ITEMS.forEach(i=>SHOP_MAP[i.name]=i.price);

/* ---------- ì“°ë ˆê¸° ë“œë í…Œì´ë¸” ---------- */
const SCRAP_TABLE = [
  ['ì¡°ìˆ˜ì˜ ëˆˆë¬¼', 6], ['ë¨¼ì§€(ê½)', 30], ['ë°•ì‚¬ì˜ ë¨¸ë¦¬ì¹´ë½', 8],
  ['ê³ ì² ',15], ['ì†œ',6], ['ëª»',10], ['ë‚˜ë¬´ì¡°ê°',6], ['ë‚˜ë¬´',8],
  ['ë¹„ë‹',4], ['í”Œë¼ìŠ¤í‹± ì¡°ê°',4], ['í”Œë¼ìŠ¤í‹±',3], ['ê°€ì£½',3],
  ['í™”ì•½',2], ['í™ë­‰ì¹˜',3], ['ëŒì¡°ê°',2], ['ëŒ',2],
  ['ë‹¤ì´ì•„ëª¬ë“œ',0.5], ['ë°˜ë„ì²´',0.5], ['ë°•ì‚¬ì˜ ì•ˆê²½',0.5], ['ìš©ì˜ ë¹„ëŠ˜',0.5],
  ['í•µì‹¬ë¶€í’ˆ',1]
];

/* ---------- ìƒíƒœ/ê°€ê²© ê´€ë ¨ ---------- */
const STATE_RANGES = {
  'ë§¤ìš° ì¢‹ìŒ':[0.8,0.95], 'ì¢‹ìŒ':[0.6,0.79], 'ë³´í†µ':[0.4,0.59],
  'ë‚˜ì¨':[0.25,0.39], 'ë§¤ìš° ë‚˜ì¨':[0.1,0.24]
};
const STATE_PROBS = [
  ['ë§¤ìš° ì¢‹ìŒ', 10], ['ì¢‹ìŒ',20], ['ë³´í†µ',40], ['ë‚˜ì¨',20], ['ë§¤ìš° ë‚˜ì¨',10]
]; // í¼ì„¼íŠ¸ í•© 100

/* ---------- DOM ---------- */
const logEl = document.getElementById('log');
const cmdInput = document.getElementById('cmdInput');
const sendBtn = document.getElementById('sendBtn');
const invEl = document.getElementById('inventoryList');
const shopEl = document.getElementById('shopList');
const saveListEl = document.getElementById('saveList');
const hpEl = document.getElementById('hp'), maxHpEl = document.getElementById('maxHp');
const knowEl = document.getElementById('knowledge'), repEl = document.getElementById('reputation'), moneyEl = document.getElementById('money');
const invCountEl = document.getElementById('invInventions');
const glovesCheckbox = document.getElementById('haveGloves');

/* ---------- ìœ í‹¸ ---------- */
function addLog(text, cls){
  const time = new Date().toLocaleTimeString();
  logEl.innerHTML += `[${time}] ${text}\\n`;
  logEl.scrollTop = logEl.scrollHeight;
}
function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function chooseFromTable(tbl){
  const total = tbl.reduce((s,i)=>s+i[1],0); let x=Math.random()*total;
  for(const [it,w] of tbl){ if(x < w) return it; x-=w; } return tbl[0][0];
}
function chooseState(){
  let x=Math.random()*100; let acc=0;
  for(const [s,w] of STATE_PROBS){ acc+=w; if(x<acc) return s; }
  return 'ë³´í†µ';
}
function randomRange(min,max){ return Math.random()*(max-min)+min; }

/* ---------- UI ì—…ë°ì´íŠ¸ ---------- */
function updateStats(){
  hpEl.textContent = state.hp; maxHpEl.textContent = state.maxHp;
  knowEl.textContent = state.knowledge; repEl.textContent = state.reputation;
  moneyEl.textContent = state.money; invCountEl.textContent = state.inventions.length;
  glovesCheckbox.checked = state.gloves;
  renderInventory(); renderShop(); listSaves();
}
function renderInventory(){
  const inv = state.inventory; const keys = Object.keys(inv);
  if(keys.length===0){ invEl.textContent='(ì•„ì§ ì•„ì´í…œ ì—†ìŒ)'; return; }
  let html = '<table><thead><tr><th>ì•„ì´í…œ</th><th>ìˆ˜ëŸ‰</th></tr></thead><tbody>';
  for(const k of keys) html += `<tr><td>${k}</td><td>${inv[k]}</td></tr>`;
  html += '</tbody></table>'; invEl.innerHTML = html;
}
function renderShop(){
  shopEl.innerHTML = SHOP_ITEMS.map(i=>`<div style="padding:6px 0"><strong>${i.name}</strong> â€” ${i.price}ì½”ì¸</div>`).join('');
}

/* ---------- ì €ì¥ ê´€ë¦¬ (localStorage) ---------- */
const SAVE_KEY = 'mb_saves';
function loadSaves(){ return JSON.parse(localStorage.getItem(SAVE_KEY)||'[]'); }
function saveSaves(arr){ localStorage.setItem(SAVE_KEY, JSON.stringify(arr)); }
function listSaves(){
  const arr = loadSaves(); if(arr.length===0){ saveListEl.textContent='ì €ì¥íŒŒì¼ ì—†ìŒ'; return; }
  saveListEl.innerHTML = arr.map((s,i)=>`<div>${i+1}. <strong>${s.name}</strong> â€” ${s.desc} â€” ${s.day}ì¼ì°¨ â€” ì²´ë ¥:${s.stats.hp} ì§€ì‹:${s.stats.knowledge} ëª…ì„±:${s.stats.reputation} ëˆ:${s.stats.money}</div>`).join('');
}

/* ---------- ê²Œì„ ëª…ë ¹ì–´ ì²˜ë¦¬ ---------- */
function cmdParser(raw){
  if(!raw) return;
  addLog('> ' + raw);
  const parts = raw.trim().split(/\\s+/);
  const cmd = parts[0];
  const args = parts.slice(1);

  // ê¸°ë³¸ ëª…ë ¹ì–´
  if(cmd === '!ê²Œì„ì‹œì‘'){
    state = JSON.parse(JSON.stringify(DEFAULT));
    addLog('ê²Œì„ ì‹œì‘! ë°•ì‚¬ë¥¼ ìš°ì£¼ìµœê³  ë°•ì‚¬ë¡œ ë§Œë“¤ì! ğŸš€');
    updateStats(); return;
  }

  if(cmd === '!ìˆ˜ì§‘'){
    let hpLoss = 5, repLoss = 3;
    if(state.gloves) { hpLoss = 2; repLoss = 1; }
    state.hp = Math.max(0, state.hp - hpLoss);
    state.reputation = Math.max(0, state.reputation - repLoss);
    const found = chooseFromTable(SCRAP_TABLE);
    state.inventory[found] = (state.inventory[found]||0)+1;
    addLog(`ê³ ë¬¼ê°€ê²Œì—ì„œ ìˆ˜ì§‘: ${found} íšë“! (ì²´ë ¥ -${hpLoss}, ëª…ì„± -${repLoss})`);
    updateStats(); return;
  }

  if(cmd === '!í‘¸ì½”ìƒì '){
    renderShop();
    addLog('í‘¸ì½”ìƒì  ì•„ì´í…œì„ í‘œì‹œí–ˆìŠµë‹ˆë‹¤. êµ¬ë§¤: !êµ¬ë§¤ [ì´ë¦„] [ìˆ˜ëŸ‰]');
    return;
  }

  if(cmd === '!êµ¬ë§¤'){
    if(args.length<1){ addLog('ì‚¬ìš©ë²•: !êµ¬ë§¤ [ì•„ì´í…œëª…] [ìˆ˜ëŸ‰]'); return; }
    const name = args[0]; const qty = Math.max(1, parseInt(args[1])||1);
    const price = SHOP_MAP[name];
    if(price===undefined){ addLog('í‘¸ì½”ìƒì ì— í•´ë‹¹ í’ˆëª©ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
    const cost = price*qty;
    if(state.money < cost){ addLog(`ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤. í•„ìš”: ${cost} ì½”ì¸`); return; }
    state.money -= cost; state.inventory[name] = (state.inventory[name]||0)+qty;
    addLog(`${name} ${qty}ê°œ êµ¬ë§¤ ì™„ë£Œ (-${cost}ì½”ì¸).`);
    updateStats(); return;
  }

  if(cmd === '!ì œì‘'){
    if(args.length < 2){ addLog('ì œì‘í•˜ë ¤ë©´ ë¶€í’ˆì„ ìµœì†Œ 2ê°œ ì´ìƒ ì…ë ¥í•˜ì„¸ìš”. ì˜ˆ: !ì œì‘ ëª» ê³ ì² '); return; }
    if(args.length > 10){ addLog('ë¶€í’ˆì€ ìµœëŒ€ 10ê°œê¹Œì§€ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.'); return; }
    // ì¬ë£Œ ì²´í¬
    const need = {};
    for(const a of args){ need[a] = (need[a]||0)+1; }
    const lacking = [];
    for(const k in need){ if((state.inventory[k]||0) < need[k]) lacking.push(`${k} ${need[k]- (state.inventory[k]||0)}ê°œ`); }
    if(lacking.length>0){ addLog('ì¬ë£Œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤: ' + lacking.join(', ')); return; }
    // ì¬ë£Œ ì†Œëª¨
    for(const k in need){ state.inventory[k] -= need[k]; if(state.inventory[k]===0) delete state.inventory[k]; }
    // ì´ë¦„ ìƒì„± (ìˆ˜íˆ¬ë“€ì˜¤ ìŠ¤íƒ€ì¼)
    const name = generateSutuName(args);
    // ëŠ¥ë ¥ ëœë¤(ê°„ë‹¨)
    const ability = generateAbilityGuess(args);
    // ìƒíƒœ ë¶€ì—¬
    const stateName = chooseState();
    // ì›ê°€: í•© ì‚°ì • (ìƒì ê°€ê²© ê¸°ì¤€ ìˆìœ¼ë©´ ì´ìš©, ì—†ìœ¼ë©´ 100 ê¸°ë³¸)
    let baseCost = 0;
    for(const a of args){ baseCost += (SHOP_MAP[a] || 100); }
    // ì›ê°€ì—ì„œ 10~30% í• ì¸ ì ìš©
    const discount = randomRange(0.10,0.30);
    const finalPrice = Math.max(1, Math.round(baseCost * (1 - discount)));
    // ë°œëª…í’ˆ ìƒì„±
    const inv = {name, components: args.slice(), state: stateName, ability, basePrice: finalPrice};
    state.inventions.push(inv);
    addLog(`ë°œëª…ì™„ë£Œ: "${name}" ìƒì„±! (ìƒíƒœ: ${stateName}) ê°€ê²©(ì›ê°€ê³„ì‚°): ${finalPrice} ì½”ì¸`);
    updateStats(); return;
  }

  if(cmd === '!ì €ì¥'){
    const name = args.join(' ') || prompt('ì €ì¥íŒŒì¼ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì²«ë²ˆì§¸ì €ì¥)');
    if(!name){ addLog('ì €ì¥ ì·¨ì†Œ. ì´ë¦„ì´ í•„ìš”í•©ë‹ˆë‹¤.'); return; }
    // ì„¤ëª… ì…ë ¥
    const desc = prompt('ì €ì¥ì„¤ëª…(ìµœëŒ€150ì)ì„ ì…ë ¥í•˜ì„¸ìš”','');
    const arr = loadSaves();
    if(arr.length >= 10){ addLog('ì €ì¥ ìŠ¬ë¡¯ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤ (ìµœëŒ€ 10). ê¸°ì¡´ ì €ì¥ì„ ì‚­ì œí•˜ì„¸ìš”.'); return; }
    const slot = {name, desc: desc||'', day: state.day, stats: {hp:state.hp,knowledge:state.knowledge,reputation:state.reputation,money:state.money}, inventory: state.inventory, inventions: state.inventions};
    arr.push(slot); saveSaves(arr);
    addLog(`ì €ì¥ ì™„ë£Œ: ${name} â€” ${desc||'(ì„¤ëª… ì—†ìŒ)'}`);
    listSaves(); return;
  }

  if(cmd === '!ë¶ˆëŸ¬ì˜¤ê¸°'){
    const arr = loadSaves();
    if(arr.length===0){ addLog('ì €ì¥ëœ ê²Œì„ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
    if(args.length===0){
      // ëª©ë¡ ì¶œë ¥ ì•ˆë‚´
      addLog('ì €ì¥ ëª©ë¡:');
      arr.forEach((s,i)=> addLog(`${i+1}. ${s.name} â€” ${s.desc} â€” ${s.day}ì¼ì°¨ (ëª…ë ¹ì–´: !ë¶ˆëŸ¬ì˜¤ê¸° ${i+1})`));
      return;
    } else {
      const idx = parseInt(args[0]) - 1;
      if(isNaN(idx) || idx<0 || idx>=arr.length){ addLog('ì˜ëª»ëœ ë²ˆí˜¸ì…ë‹ˆë‹¤.'); return; }
      const s = arr[idx];
      // ë¶ˆëŸ¬ì˜¤ê¸° (ê°„ë‹¨ ë³µì‚¬)
      state.day = s.day; state.hp = s.stats.hp; state.knowledge = s.stats.knowledge; state.reputation = s.stats.reputation; state.money = s.stats.money;
      state.inventory = JSON.parse(JSON.stringify(s.inventory)); state.inventions = JSON.parse(JSON.stringify(s.inventions));
      addLog(`ì €ì¥ ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ: ${s.name} (ì„¤ëª…: ${s.desc})`);
      updateStats(); return;
    }
  }

  if(cmd === '!ì €ì¥ì‚­ì œ'){
    const name = args.join(' ');
    if(!name){ addLog('ì‚¬ìš©ë²•: !ì €ì¥ì‚­ì œ [ì €ì¥íŒŒì¼ì´ë¦„]'); return; }
    let arr = loadSaves();
    const idx = arr.findIndex(s=>s.name===name);
    if(idx===-1){ addLog('í•´ë‹¹ ì´ë¦„ì˜ ì €ì¥íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
    if(!confirm(`"${name}" ì €ì¥íŒŒì¼ì„ ì •ë§ ì‚­ì œí• ê¹Œìš”?`)) { addLog('ì‚­ì œ ì·¨ì†Œ'); return; }
    arr.splice(idx,1); saveSaves(arr); addLog(`ì €ì¥íŒŒì¼ "${name}" ì‚­ì œ ì™„ë£Œ.`); listSaves(); return;
  }

  if(cmd === '!ë„ì„œê´€' || cmd === '!ë…ì„œ'){
    if(state.money < 500){ addLog('ë„ì„œê´€ ì…ì¥ë£Œ 500ì½”ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'); return; }
    state.money -= 500;
    const gain = randInt(10,30); state.knowledge += gain;
    addLog(`ë„ì„œê´€ì—ì„œ ë…ì„œ: ì§€ì‹ +${gain} íšë“ (500ì½”ì¸ ì†Œëª¨)`);
    updateStats(); return;
  }

  if(cmd === '!í—¬ìŠ¤ì¥' || cmd === '!ìš´ë™'){
    if(state.money < 500){ addLog('í—¬ìŠ¤ì¥ ì…ì¥ë£Œ 500ì½”ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'); return; }
    state.money -= 500;
    const gain = randInt(10,30); state.maxHp += gain; // í•˜ë£¨ ì§€ë‚˜ë©´ í’€í”¼ ìœ ì§€ ë¡œì§ì€ ì¶”í›„ ì¶”ê°€
    addLog(`í—¬ìŠ¤ì¥ì—ì„œ ìš´ë™: ìµœëŒ€ì²´ë ¥ +${gain} ì¦ê°€ (500ì½”ì¸ ì†Œëª¨)`);
    updateStats(); return;
  }

  if(cmd === '!ê°ì •'){
    if(args.length < 2){ addLog('ì‚¬ìš©ë²•: !ê°ì • [ê°€ê²©|ìƒíƒœ|ëŠ¥ë ¥|ëª¨ë‘] [ë°œëª…í’ˆì´ë¦„]'); return; }
    const mode = args[0]; const name = args.slice(1).join(' ');
    const inv = state.inventions.find(x=>x.name === name);
    if(!inv){ addLog('í•´ë‹¹ ë°œëª…í’ˆì„ ë³´ìœ í•˜ê³  ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }
    if(mode === 'ëª¨ë‘'){
      if(state.money < 5500){ addLog('ê°ì •(ëª¨ë‘) ë¹„ìš© 5500ì½”ì¸ í•„ìš”'); return; }
      state.money -= 5500; addLog(`${name} â€” ê°€ê²©: ${inv.basePrice}ì½”ì¸ / ìƒíƒœ: ${inv.state} / ëŠ¥ë ¥: ${inv.ability || '(ì—†ìŒ)'}`); updateStats(); return;
    } else {
      if(state.money < 2000){ addLog('ê°ì • ë¹„ìš© 2000ì½”ì¸ í•„ìš”'); return; }
      state.money -= 2000;
      if(mode === 'ê°€ê²©'){ addLog(`${name}ì˜ ê°€ê²©: ${inv.basePrice} ì½”ì¸`); }
      else if(mode === 'ìƒíƒœ'){ addLog(`${name}ì˜ ìƒíƒœ: ${inv.state}`); }
      else if(mode === 'ëŠ¥ë ¥'){ addLog(`${name}ì˜ ëŠ¥ë ¥: ${inv.ability || '(ì—†ìŒ)'}`); }
      else addLog('ê°ì • í•­ëª©ì€ ê°€ê²©/ìƒíƒœ/ëŠ¥ë ¥/ëª¨ë‘ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.');
      updateStats(); return;
    }
  }

  // ì•Œ ìˆ˜ ì—†ëŠ” ëª…ë ¹ì–´
  addLog('ì•Œ ìˆ˜ ì—†ëŠ” ëª…ë ¹ì–´ì…ë‹ˆë‹¤. "ëª…ë ¹ì–´ ë„ì›€"ì„ ëˆŒëŸ¬ í™•ì¸í•˜ì„¸ìš”.');
}

/* ---------- ë³´ì¡°: ìˆ˜íˆ¬ë“€ì˜¤ ìŠ¤íƒ€ì¼ ì´ë¦„/ëŠ¥ë ¥ ìƒì„± ---------- */
const SUTU_PREFIX = ['ê´‘ì¹ ì˜','ë°•ì‚¬ì˜','ì´ˆìš°ì£¼ì˜','ë˜¥ë§›','ë¬´í•œ','ì°í•œ','ì—‘ìŠ¤','ì¡°ìˆ˜ë¶ˆì•ˆì •','ê°ˆë¼ì§„','ë¯¸ë„ëŸ¼'];
const SUTU_MID = ['ë¯¸ë„ëŸ¼','ë˜¥êµ¬ë©','ê´‘ê¸°','ì‹œê°„','ë„íŒŒë¯¼','ëŒì—°ë³€ì´','ì´ˆì§„ê³µ','ë“±ê°€êµí™˜','ì–¼êµ´','í–‰ë³µ'];
const SUTU_SUFFIX = ['ì¥ê°‘','ë¦¬ëª¨ì½˜','ê¸°ê³„','ë°•ìŠ¤','ë²„íŠ¼','ì•Œì•½','ë§ì¹˜','ì„ ê¸€ë¼ìŠ¤','ë¨¸ì‹ ','ì˜ì'];

function generateSutuName(parts){
  // parts influence: if special words present, bias name
  const p = parts.join(' ').toLowerCase();
  let prefix = SUTU_PREFIX[Math.floor(Math.random()*SUTU_PREFIX.length)];
  let mid = SUTU_MID[Math.floor(Math.random()*SUTU_MID.length)];
  let suffix = SUTU_SUFFIX[Math.floor(Math.random()*SUTU_SUFFIX.length)];
  // If 'ë°•ì‚¬ì˜' components present, emphasize
  if(p.includes('ë°•ì‚¬ì˜')) prefix = 'ë°•ì‚¬ì˜';
  // If 'ë‹¤ì´ì•„ëª¬ë“œ' or 'ìˆ˜ì„' ë“¤ì–´ê°€ë©´ elevate name
  if(p.includes('ë‹¤ì´ì•„ëª¬ë“œ')||p.includes('ìˆ˜ì„')) { prefix = 'ì‹ ì„±í•œ'; mid = 'ë¹›ë‚˜ëŠ”'; suffix = 'ì¥ì¹˜'; }
  // assemble
  const name = `${prefix} ${mid}${suffix.includes('ë¦¬ëª¨')?'':' '}${suffix}`.replace(/\s+/g,' ').trim();
  // Add random quirky postfix sometimes
  if(Math.random() < 0.25) return name + ' (Î²í˜•)';
  return name;
}

function generateAbilityGuess(parts){
  // simple heuristics
  if(parts.some(x=>/(ë‹¤ì´ì•„ëª¬ë“œ|ë°˜ë„ì²´|ì•”í‘ë¬¼ì§ˆ|í•µì‹¬ë¶€í’ˆ|ì‹ ì˜ ê¸ˆì†)/.test(x))) return 'ê°•ë ¥í•œ íŠ¹ìˆ˜ íš¨ê³¼(ë¶ˆì•ˆì •)';
  if(parts.some(x=>/(ë§ì¹˜|íœì¹˜|ì œì‘ëŒ€)/.test(x))) return 'ì œì‘Â·ìˆ˜ë¦¬ ë³´ì¡°';
  if(parts.some(x=>/(ë°•ì‚¬ì˜ ë¨¸ë¦¬ì¹´ë½|ë°•ì‚¬ì˜ ì•ˆê²½)/.test(x))) return 'ì§€ì‹Â·ì—°êµ¬ ë³´ë„ˆìŠ¤';
  if(Math.random() < 0.3) return '(ëŠ¥ë ¥ ì—†ìŒ)';
  return 'ì‘ì—… ë³´ì¡°(ì†ŒëŸ‰ì˜ ì´ë“)';
}

/* ---------- ì´ë²¤íŠ¸ ë°”ì¸ë”© ---------- */
sendBtn.addEventListener('click', ()=>{ const v = cmdInput.value.trim(); if(v) { cmdParser(v); cmdInput.value=''; }});
cmdInput.addEventListener('keypress', (e)=>{ if(e.key==='Enter'){ sendBtn.click(); }} );
glovesCheckbox.addEventListener('change', ()=>{ state.gloves = glovesCheckbox.checked; addLog(`ì¥ê°‘ ${state.gloves ? 'ì°©ìš©' : 'í•´ì œ'}`); updateStats(); });

/* ---------- ì´ˆê¸°í™” ---------- */
addLog('ëª©ë°•ì‚¬ RPG ì›¹ ë°ëª¨ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤! !ê²Œì„ì‹œì‘ ìœ¼ë¡œ ì‹œì‘í•˜ì„¸ìš”.');
renderShop();
updateStats();

/* ---------- ì™¸ë¶€ í˜¸ì¶œ ë„ì›€ í•¨ìˆ˜ (ë²„íŠ¼ìš©) ---------- */
function showHelp(){
  addLog('ëª…ë ¹ì–´ ë„ì›€:\\n!ê²Œì„ì‹œì‘ / !ìˆ˜ì§‘ / !í‘¸ì½”ìƒì  / !êµ¬ë§¤ [ì´ë¦„] [ìˆ˜ëŸ‰] / !ì œì‘ ë¶€í’ˆ1 ë¶€í’ˆ2 ...\\n!ì €ì¥ [ì´ë¦„] / !ë¶ˆëŸ¬ì˜¤ê¸° / !ì €ì¥ì‚­ì œ [ì´ë¦„]\\n!ë„ì„œê´€ / !ë…ì„œ / !í—¬ìŠ¤ì¥ / !ìš´ë™ / !ê°ì • [ê°€ê²©|ìƒíƒœ|ëŠ¥ë ¥|ëª¨ë‘] [ë°œëª…í’ˆì´ë¦„]');
}
function quickStart(){ cmdParser('!ê²Œì„ì‹œì‘'); }
function openShop(){ cmdParser('!í‘¸ì½”ìƒì '); }
function listSaves(){ cmdParser('!ë¶ˆëŸ¬ì˜¤ê¸°'); }

/* ---------- ì €ì¥ í—¬í¼ (localStorage wrapper) ---------- */
function loadSaves(){ return JSON.parse(localStorage.getItem('mb_saves')||'[]'); }
function saveSaves(arr){ localStorage.setItem('mb_saves', JSON.stringify(arr)); }

/* ---------- ìœ í‹¸ ë…¸íŠ¸: randomRange ---------- */
function randomRange(a,b){ return Math.random()*(b-a)+a; }

</script>
</body>
</html>
