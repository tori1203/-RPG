<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>목박사 RPG - 장소별 기능</title>
<style>
  body {
    background: #111;
    color: #eee;
    font-family: Arial, sans-serif;
    padding: 20px;
    user-select: none;
  }
  #stats {
    margin-bottom: 20px;
    font-size: 16px;
    background: #222;
    padding: 10px;
    border-radius: 8px;
  }
  #dialogue {
    background: #222;
    padding: 15px;
    border-radius: 8px;
    min-height: 70px;
    font-size: 18px;
    margin-bottom: 20px;
  }
  #choices button, #actionBtn {
    background: #444;
    border: none;
    color: #eee;
    padding: 10px 15px;
    margin: 5px 5px 5px 0;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    transition: background 0.3s;
  }
  #choices button:hover, #actionBtn:hover {
    background: #666;
  }
  #locationBtn {
    position: fixed;
    bottom: 20px;
    left: 20px;
    background: #333;
    border: none;
    color: #eee;
    padding: 12px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    z-index: 101;
  }
  #locationList {
    position: fixed;
    bottom: 70px;
    left: 20px;
    background: #222;
    border-radius: 8px;
    padding: 10px;
    max-width: 300px;
    box-shadow: 0 0 15px #000;
    display: none;
    z-index: 100;
  }
  #locationList button {
    width: 100%;
    margin-bottom: 8px;
  }
  #actionArea {
    margin-bottom: 20px;
  }
</style>
</head>
<body>

<div id="stats"></div>
<div id="dialogue"></div>
<div id="actionArea"></div>
<div id="choices"></div>

<button id="locationBtn">장소 이동</button>
<div id="locationList"></div>

<script>
(() => {
  const player = {
    hpMax: 100,
    hp: 100,
    atk: 10,
    mp: 30,
    crit: 5,
    money: 10000,
    turn: 1,
  };

  const statsDiv = document.getElementById("stats");
  const dialogueDiv = document.getElementById("dialogue");
  const choicesDiv = document.getElementById("choices");
  const locationBtn = document.getElementById("locationBtn");
  const locationList = document.getElementById("locationList");
  const actionArea = document.getElementById("actionArea");

  let currentLine = 0;
  let currentScript = [];
  let currentLocation = "튜토리얼";

  const locationScripts = {
    "튜토리얼": [
      { speaker: "박사", text: "튜토리얼 장소에 왔습니다." },
      { speaker: "박사", text: "기본적인 조작법을 익힙니다." },
      { speaker: "박사", text: "엔터키로 다음을 넘기고, 선택지는 클릭하세요." },
      { speaker: null, text: "이제 다른 장소로 이동해보세요.", choices: [
        { text: "고물상점으로 이동", nextLocation: "고물상점" },
        { text: "헬스장으로 이동", nextLocation: "헬스장" }
      ]},
    ],
    "고물상점": [
      { speaker: null, text: "고물상점에 도착했습니다. 부품을 구매할 수 있습니다." },
      { speaker: null, text: "하지만 아직 구매 시스템은 없어요.", choices: [
        { text: "튜토리얼로 돌아가기", nextLocation: "튜토리얼" },
        { text: "헬스장으로 이동", nextLocation: "헬스장" },
        { text: "푸코상점으로 이동", nextLocation: "푸코상점" }
      ]}
    ],
    "헬스장": [
      { speaker: null, text: "헬스장에 왔습니다. 운동하면 체력이 늘어납니다." },
      { speaker: null, text: "운동은 2000원을 내야 합니다.", choices: [
        { text: "튜토리얼로 돌아가기", nextLocation: "튜토리얼" },
        { text: "고물상점으로 이동", nextLocation: "고물상점" },
        { text: "도서관으로 이동", nextLocation: "도서관" }
      ]}
    ],
    "푸코상점": [
      { speaker: null, text: "푸코상점에 도착했습니다. 다양한 아이템을 판매합니다." },
      { speaker: null, text: "구매 기능은 추후 추가 예정입니다.", choices: [
        { text: "고물상점으로 이동", nextLocation: "고물상점" },
        { text: "도박장으로 이동", nextLocation: "도박장" }
      ]}
    ],
    "도서관": [
      { speaker: null, text: "도서관에 왔습니다. 지식을 쌓을 수 있습니다." },
      { speaker: null, text: "독서는 2000원을 내야 합니다.", choices: [
        { text: "헬스장으로 이동", nextLocation: "헬스장" },
        { text: "과학실로 이동", nextLocation: "과학실" }
      ]}
    ],
    "도박장": [
      { speaker: null, text: "도박장에 왔습니다. 운을 시험해보세요!" },
      { speaker: null, text: "도박은 리스크가 큽니다.", choices: [
        { text: "푸코상점으로 이동", nextLocation: "푸코상점" },
        { text: "제련소로 이동", nextLocation: "제련소" }
      ]}
    ],
    "과학실": [
      { speaker: null, text: "과학실에 도착했습니다. 새로운 기술을 연구할 수 있습니다." },
      { speaker: null, text: "연구는 추후 구현 예정입니다.", choices: [
        { text: "도서관으로 이동", nextLocation: "도서관" },
        { text: "정보거래소로 이동", nextLocation: "정보거래소" }
      ]}
    ],
    "제련소": [
      { speaker: null, text: "제련소에 왔습니다. 무기를 강화할 수 있습니다." },
      { speaker: null, text: "강화 시스템은 아직 미완성입니다.", choices: [
        { text: "도박장으로 이동", nextLocation: "도박장" },
        { text: "판매소로 이동", nextLocation: "판매소" }
      ]}
    ],
    "정보거래소": [
      { speaker: null, text: "정보거래소에 왔습니다. 다양한 정보를 거래합니다." },
      { speaker: null, text: "정보 거래 기능은 추후 추가됩니다.", choices: [
        { text: "과학실로 이동", nextLocation: "과학실" },
        { text: "판매소로 이동", nextLocation: "판매소" }
      ]}
    ],
    "판매소": [
      { speaker: null, text: "판매소에 왔습니다. 아이템을 판매할 수 있습니다." },
      { speaker: null, text: "판매 기능은 준비 중입니다.", choices: [
        { text: "정보거래소로 이동", nextLocation: "정보거래소" },
        { text: "제련소로 이동", nextLocation: "제련소" }
      ]}
    ]
  };

  // 장소별 고유 기능 버튼 활성화
  function showActionButton(){
    actionArea.innerHTML = "";
    if(currentLocation === "헬스장"){
      const btn = document.createElement("button");
      btn.id = "actionBtn";
      btn.textContent = "운동하기 (2000원)";
      btn.onclick = () => doExercise();
      actionArea.appendChild(btn);
    } else if(currentLocation === "도서관"){
      const btn = document.createElement("button");
      btn.id = "actionBtn";
      btn.textContent = "독서하기 (2000원)";
      btn.onclick = () => doRead();
      actionArea.appendChild(btn);
    } else if(currentLocation === "도박장"){
      const btn = document.createElement("button");
      btn.id = "actionBtn";
      btn.textContent = "도박하기 (운 시험)";
      btn.onclick = () => gamble();
      actionArea.appendChild(btn);
    }
  }

  // 고유 기능 함수들
  function doExercise(){
    if(player.money < 2000){
      alert("돈이 부족합니다!");
      return;
    }
    player.money -= 2000;
    player.hp = Math.min(player.hpMax, player.hp + 10);
    player.turn++;
    alert("운동으로 체력이 10 회복되었습니다!");
    updateStats();
    showLine();
  }

  function doRead(){
    if(player.money < 2000){
      alert("돈이 부족합니다!");
      return;
    }
    player.money -= 2000;
    player.mp += 10;
    player.turn++;
    alert("독서로 마나가 10 회복되었습니다!");
    updateStats();
    showLine();
  }

  function gamble(){
    if(player.money < 1000){
      alert("돈이 부족합니다! 도박 시작하려면 최소 1000원이 필요합니다.");
      return;
    }
    const bet = 1000;
    player.money -= bet;
    const win = Math.random() < 0.5;
    if(win){
      player.money += bet * 2;
      alert("도박에서 이겼습니다! 돈이 2000원 증가했습니다!");
    } else {
      alert("도박에서 졌습니다... 1000원을 잃었습니다.");
    }
    player.turn++;
    updateStats();
    showLine();
  }

  function updateStats(){
    statsDiv.textContent = `체력: ${player.hp}/${player.hpMax} | 공격력: ${player.atk} | 마나: ${player.mp} | 치명타: ${player.crit}% | 돈: ${player.money}원 | 턴: ${player.turn}`;
  }

  function showLine(){
    if(currentLine >= currentScript.length){
      dialogueDiv.textContent = "";
      choicesDiv.innerHTML = "";
      showActionButton(); // 장소별 액션 버튼 보여주기
      return;
    }
    updateStats();
    const line = currentScript[currentLine];
    dialogueDiv.textContent = (line.speaker ? line.speaker + ": " : "") + (line.text || "");
    choicesDiv.innerHTML = "";

    if(line.choices){
      line.choices.forEach(choice => {
        const btn = document.createElement("button");
        btn.textContent = choice.text;
        btn.onclick = () => {
          if(choice.nextLocation){
            goToLocation(choice.nextLocation);
          } else if(choice.next !== undefined){
            currentLine = choice.next;
            showLine();
          }
        }
        choicesDiv.appendChild(btn);
      });
      document.onkeydown = null;
    } else {
      document.onkeydown = (e) => {
        if(e.key === "Enter"){
          currentLine++;
          showLine();
        }
      };
    }
  }

  function goToLocation(name){
    if(!locationScripts[name]){
      alert("해당 장소가 없습니다: " + name);
      return;
    }
    currentLocation = name;
    currentScript = locationScripts[name];
    currentLine = 0;
    locationList.style.display = "none";
    actionArea.innerHTML = "";
    showLine();
  }

  locationBtn.onclick = () => {
    if(locationList.style.display === "block"){
      locationList.style.display = "none";
      return;
    }
    locationList.innerHTML = "";
    Object.keys(locationScripts).forEach(loc => {
      const btn = document.createElement("button");
      btn.textContent = loc;
      btn.onclick = () => {
        goToLocation(loc);
      };
      locationList.appendChild(btn);
    });
    locationList.style.display = "block";
  };

  goToLocation("튜토리얼");
})();
</script>

</body>
</html>
